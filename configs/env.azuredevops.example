# =============================================================================
# Azure DevOps to GitHub Migration - Environment Configuration
# =============================================================================
# Copy this file to `.env` and customize for your Azure DevOps source setup
#
# This configuration is specifically for:
#   SOURCE: Azure DevOps Services
#   DESTINATION: GitHub (Enterprise Cloud, EMU, or Data Residency)
#
# For GitHub sources, use: env.github.example
# =============================================================================

# =============================================================================
# Server Configuration
# =============================================================================
GHMIG_SERVER_PORT=8080

# =============================================================================
# Database Configuration
# =============================================================================
# Database type: "sqlite", "postgres", or "sqlserver"
GHMIG_DATABASE_TYPE=sqlite
GHMIG_DATABASE_DSN=./data/migrator.db

# Optional: Database connection pool settings (uncomment if using PostgreSQL/SQL Server)
# GHMIG_DATABASE_MAX_OPEN_CONNS=25
# GHMIG_DATABASE_MAX_IDLE_CONNS=5
# GHMIG_DATABASE_CONN_MAX_LIFETIME_SECONDS=300

# PostgreSQL specific (if using postgres)
# GHMIG_DATABASE_SSL_MODE=require

# SQL Server specific (if using sqlserver)
# GHMIG_DATABASE_TRUST_SERVER_CERTIFICATE=false

# =============================================================================
# SOURCE: Azure DevOps Configuration
# =============================================================================

# Source type - MUST be "azuredevops"
GHMIG_SOURCE_TYPE=azuredevops

# Azure DevOps Organization URL
# Format: https://dev.azure.com/YOUR_ORGANIZATION
# Example: https://dev.azure.com/contoso
#
# MULTI-ORGANIZATION SUPPORT:
# - This URL is used for initial discovery/configuration
# - The system automatically supports migrating from MULTIPLE ADO organizations
# - During migration, each repository's source URL determines its specific ADO org/project/repo
# - A single migration source (https://dev.azure.com) is created per GitHub's requirements
# - Your PAT must have access to ALL organizations you want to migrate from
GHMIG_SOURCE_BASE_URL=https://dev.azure.com/YOUR_ORGANIZATION

# Azure DevOps Personal Access Token (PAT)
# Create at: Azure DevOps → User Settings → Personal Access Tokens
# 
# Required scopes:
#   - Code (Read): Access repository data
#   - Build (Read): Access pipeline information
#   - Work Items (Read): Access work item data
#   - Project and Team (Read): Access project information
#   - Graph (Read): Access organizational structure
#
# IMPORTANT FOR MULTI-ORG:
# - This PAT must have access to ALL Azure DevOps organizations you want to migrate from
# - If migrating from org1, org2, and org3, the PAT needs permissions in all three
# - A single migration source is used for all ADO repos (per GitHub's API requirements)
GHMIG_SOURCE_TOKEN=your-ado-pat-token-here

# Azure DevOps Organization Name
# Example: If URL is https://dev.azure.com/contoso, use "contoso"
# Note: Used for initial discovery; multi-org migrations are handled automatically
GHMIG_SOURCE_ORGANIZATION=YOUR_ORGANIZATION

# =============================================================================
# DESTINATION: GitHub Configuration
# =============================================================================

# Destination type - MUST be "github" (GEI requirement)
GHMIG_DESTINATION_TYPE=github

# GitHub Base URL
# - For GitHub Cloud: https://api.github.com
# - For GitHub Enterprise Server: https://github.example.com/api/v3
GHMIG_DESTINATION_BASE_URL=https://api.github.com

# --- Authentication: Choose ONE method ---

# METHOD 1: Personal Access Token (PAT) - Simplest
# Create at: GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic)
# Required scopes: repo, admin:org, workflow
GHMIG_DESTINATION_TOKEN=ghp_YourDestinationGitHubPATHere

# METHOD 2: GitHub App (Recommended for production)
# Create at: GitHub → Settings → Developer settings → GitHub Apps
# GHMIG_DESTINATION_APP_ID=234567
# GHMIG_DESTINATION_APP_PRIVATE_KEY=-----BEGIN RSA PRIVATE KEY-----\nYourKey\n-----END RSA PRIVATE KEY-----
# GHMIG_DESTINATION_APP_INSTALLATION_ID=890123

# =============================================================================
# Migration Settings
# =============================================================================

# Number of concurrent migration workers
GHMIG_MIGRATION_WORKERS=5

# Polling interval for migration status (seconds)
GHMIG_MIGRATION_POLL_INTERVAL_SECONDS=30

# Post-migration settings mode: "production_only", "always", or "never"
GHMIG_MIGRATION_POST_MIGRATION_MODE=production_only

# Action when destination repo exists: "fail", "skip", or "overwrite"
GHMIG_MIGRATION_DEST_REPO_EXISTS_ACTION=fail

# Visibility handling - ADO repos typically migrate as private
GHMIG_MIGRATION_VISIBILITY_HANDLING_PUBLIC_REPOS=private
GHMIG_MIGRATION_VISIBILITY_HANDLING_INTERNAL_REPOS=private

# =============================================================================
# Logging Configuration
# =============================================================================
GHMIG_LOGGING_LEVEL=info
GHMIG_LOGGING_FORMAT=json
GHMIG_LOGGING_OUTPUT_FILE=./logs/migrator.log
GHMIG_LOGGING_MAX_SIZE=100
GHMIG_LOGGING_MAX_BACKUPS=3
GHMIG_LOGGING_MAX_AGE=28

# =============================================================================
# Authentication & Authorization (Optional - for web UI)
# =============================================================================
#
# DESTINATION-CENTRIC AUTHENTICATION MODEL:
# The GitHub Migrator uses destination-centric authentication. This means:
#   - ALL users authenticate via GitHub OAuth (the destination)
#   - No source-specific OAuth is required (no Entra ID for ADO sources)
#   - Users only need to log in once, regardless of how many sources exist
#
# This simplifies setup for multi-source migrations while maintaining security
# through identity mapping for self-service migrations.

# Enable authentication for web interface
GHMIG_AUTH_ENABLED=false

# --- GitHub OAuth App Configuration ---
# Create at: GitHub → Settings → Developer settings → OAuth Apps
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_ID=Iv1.YourClientID
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_SECRET=YourClientSecret
# GHMIG_AUTH_CALLBACK_URL=http://localhost:8080/api/v1/auth/callback
# GHMIG_AUTH_FRONTEND_URL=http://localhost:3000

# Session configuration
# GHMIG_AUTH_SESSION_SECRET=your-random-secret-key-here-use-openssl-rand-base64-32
# GHMIG_AUTH_SESSION_DURATION_HOURS=24

# --- Authorization Rules ---
# The system uses a destination-centric authorization model with three tiers:
#   Tier 1 (Admin): Full migration rights - can migrate any repository
#   Tier 2 (Self-Service): Can migrate repos where user is admin on source
#   Tier 3 (Read-Only): Can view but not initiate migrations

# Restrict access to specific organizations
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ORG_MEMBERSHIP=org1,org2

# --- Tier 1 (Admin) Access Configuration ---

# Migration Admin Teams - members get Tier 1 access (format: "org/team-slug")
# GHMIG_AUTH_AUTHORIZATION_RULES_MIGRATION_ADMIN_TEAMS=platform-eng/migration-admins

# Allow org admins of required orgs to have Tier 1 access
# GHMIG_AUTH_AUTHORIZATION_RULES_ALLOW_ORG_ADMIN_MIGRATIONS=true

# Enterprise admin checks
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_ADMIN=false
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_SLUG=your-enterprise
# GHMIG_AUTH_AUTHORIZATION_RULES_ALLOW_ENTERPRISE_ADMIN_MIGRATIONS=true

# --- Tier 2 (Self-Service) Configuration ---

# Enable self-service migrations (with identity mapping requirement)
# When true, self-service tier is enabled - users who complete identity mapping
#   (linking their source and destination accounts) can migrate repositories
#   where their source identity has admin access
# When false, self-service tier is disabled - only Tier 1 administrators can
#   initiate migrations, all other users have read-only access
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_IDENTITY_MAPPING_FOR_SELF_SERVICE=true

# =============================================================================
# Azure DevOps Migration Notes
# =============================================================================
# 
# What Migrates from Azure DevOps to GitHub:
#   ✅ Git repository history (commits, branches, tags)
#   ✅ Pull requests (PRs) with comments and user history
#   ✅ Pull request attachments
#   ✅ Work item links on PRs
#   ✅ Branch policies (migrate as GitHub branch protection rules)
#   ✅ Git LFS objects
#   ✅ Submodules
#
# What Does NOT Migrate:
#   ❌ Azure Pipelines (YAML files migrate, but pipeline runs/history do not)
#   ❌ Azure Boards work items (only PR links migrate)
#   ❌ Wiki content
#   ❌ Azure Artifacts/packages
#   ❌ Service connections
#   ❌ Variable groups
#
# TFVC Repositories:
#   ⚠️  TFVC (Team Foundation Version Control) repositories CANNOT be migrated
#       directly. They must be converted to Git first using git-tfs or similar tools.
#       The application will detect TFVC repos and mark them for remediation.
#
# Repository Profiling:
#   The application automatically detects:
#   - TFVC vs Git repositories
#   - Azure Boards integration
#   - Azure Pipelines configuration
#   - GitHub Advanced Security for Azure DevOps
#   - Pull request counts
#   - Branch policy counts
#   - Work item counts
#
# =============================================================================
# Quick Start Examples
# =============================================================================

# Example 1: Azure DevOps Cloud to GitHub Cloud
# GHMIG_SOURCE_TYPE=azuredevops
# GHMIG_SOURCE_BASE_URL=https://dev.azure.com/contoso
# GHMIG_SOURCE_TOKEN=your-ado-pat
# GHMIG_SOURCE_ORGANIZATION=contoso
# GHMIG_DESTINATION_TYPE=github
# GHMIG_DESTINATION_BASE_URL=https://api.github.com
# GHMIG_DESTINATION_TOKEN=ghp_githubtoken

# Example 2: Azure DevOps Server to GitHub Enterprise Server
# GHMIG_SOURCE_TYPE=azuredevops
# GHMIG_SOURCE_BASE_URL=https://devops.company.com/DefaultCollection
# GHMIG_SOURCE_TOKEN=your-ado-pat
# GHMIG_SOURCE_ORGANIZATION=DefaultCollection
# GHMIG_DESTINATION_TYPE=github
# GHMIG_DESTINATION_BASE_URL=https://github.company.com/api/v3
# GHMIG_DESTINATION_TOKEN=ghp_githubtoken

# Example 3: Multi-Organization Migration
# Migrate repositories from multiple Azure DevOps organizations
# GHMIG_SOURCE_TYPE=azuredevops
# GHMIG_SOURCE_BASE_URL=https://dev.azure.com/primary-org
# GHMIG_SOURCE_TOKEN=your-ado-pat  # Must have access to ALL organizations
# GHMIG_SOURCE_ORGANIZATION=primary-org
# GHMIG_DESTINATION_TYPE=github
# GHMIG_DESTINATION_BASE_URL=https://api.github.com
# GHMIG_DESTINATION_TOKEN=ghp_githubtoken
#
# How it works:
# 1. Configure one primary organization in BASE_URL
# 2. During discovery, you can discover repos from org1, org2, org3, etc.
# 3. Each repository stores its own SourceURL (e.g., https://dev.azure.com/org2/...)
# 4. During migration, the system automatically:
#    - Extracts the ADO organization from each repository's SourceURL
#    - Creates separate GitHub migration sources per ADO organization
#    - Uses the correct source for each repository
# 5. Your PAT must have access to ALL organizations

# Example 4: With GitHub OAuth authentication for web UI
# GHMIG_SOURCE_TYPE=azuredevops
# GHMIG_SOURCE_BASE_URL=https://dev.azure.com/contoso
# GHMIG_SOURCE_TOKEN=your-ado-pat
# GHMIG_SOURCE_ORGANIZATION=contoso
# GHMIG_AUTH_ENABLED=true
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_ID=Iv1.YourClientID
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_SECRET=YourClientSecret
# GHMIG_AUTH_CALLBACK_URL=http://localhost:8080/api/v1/auth/callback
# GHMIG_AUTH_FRONTEND_URL=http://localhost:3000
# GHMIG_AUTH_SESSION_SECRET=your-random-secret-key
# GHMIG_AUTH_AUTHORIZATION_RULES_MIGRATION_ADMIN_TEAMS=my-org/migration-admins
# GHMIG_DESTINATION_TYPE=github
# GHMIG_DESTINATION_BASE_URL=https://api.github.com
# GHMIG_DESTINATION_TOKEN=ghp_githubtoken

# =============================================================================
# Additional Resources
# =============================================================================
# - Operations Guide: docs/OPERATIONS.md (includes ADO setup)
# - Deployment Guide: docs/deployment/
# - Troubleshooting: Check logs at ./logs/migrator.log
# - ADO PAT Scopes: https://learn.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate

