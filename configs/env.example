# GitHub Migrator - Environment Variables Template
# 
# USAGE:
#   1. Copy this file to .env in the project root: cp configs/env.example .env
#   2. Fill in your values below
#   3. The .env file is automatically loaded when you run the application
#   4. The .env file is gitignored - your secrets stay local
#
# Note: You don't need a config.yaml file when using .env - just set the 
# environment variables below and the application will work.

# =============================================================================
# IMPORTANT: Supported Migrations
# =============================================================================
# Supported migration paths:
# - GitHub to GitHub: GitHub.com or GitHub Enterprise Server to GitHub.com/GHEC
# - Azure DevOps to GitHub: Azure DevOps (Git repos only) to GitHub.com/GHEC
# Note: GitLab support is in development

# =============================================================================
# Source Repository System Configuration
# =============================================================================

# Source system type
# Supported: 
#   - "github" (full support - GitHub to GitHub migrations)
#   - "azuredevops" (full support - Azure DevOps to GitHub migrations)
# In development: "gitlab"
GHMIG_SOURCE_TYPE=github

# --- GitHub Source Configuration ---
# Source GitHub Personal Access Token (PAT) - REQUIRED for GitHub sources
# This token is REQUIRED for all GitHub migration operations
# For GitHub Enterprise Server or GitHub.com
# Required permissions:
# - Organization admin access (required)
# - Scopes: repo, read:org, read:user, admin:org
# Usage: If GitHub App is configured, PAT is used for migrations only
GHMIG_SOURCE_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Source GitHub Base URL
# For GitHub Enterprise Server: https://github.company.com/api/v3
# For GitHub.com: https://api.github.com
# For Azure DevOps: https://dev.azure.com/your-organization
GHMIG_SOURCE_BASE_URL=https://github.company.com/api/v3

# --- GitHub App Source Authentication (Optional) ---
# GitHub App authentication is OPTIONAL and recommended for large migrations
# When configured, GitHub App tokens are used ONLY for discovery and profiling operations
# The PAT above is still REQUIRED and used for all migration operations
# Benefits: Better rate limits for discovery, separation of concerns, reduced PAT usage
# GHMIG_SOURCE_APP_ID=123456
# GHMIG_SOURCE_APP_PRIVATE_KEY=/path/to/private-key.pem
# Or inline PEM:
# GHMIG_SOURCE_APP_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\nMIIE...\n-----END RSA PRIVATE KEY-----"
#
# GHMIG_SOURCE_APP_INSTALLATION_ID is OPTIONAL:
#   - Provide installation ID: Uses that installation's token for enterprise operations
#   - Omit installation ID: System uses GitHub App Installations API to discover
#     all organizations where the app is installed, then creates per-org clients
#     (best for multi-org GitHub Apps, requires JWT auth)
# GHMIG_SOURCE_APP_INSTALLATION_ID=789012

# --- Azure DevOps Source Configuration ---
# Azure DevOps Personal Access Token (PAT) - REQUIRED for ADO sources
# When GHMIG_SOURCE_TYPE=azuredevops, use this instead of GHMIG_SOURCE_TOKEN
# This is a server-level PAT used to execute migrations
# Create in Azure DevOps → User Settings → Personal Access Tokens
# Required scopes:
#   - Code (Read): Access repository data
#   - Build (Read): Access pipeline information  
#   - Work Items (Read): Access work item data
#   - Project and Team (Read): Access project information
#   - Graph (Read): Access organizational structure
# GHMIG_SOURCE_TOKEN=your-ado-pat-token

# Azure DevOps Organization Name - REQUIRED for ADO sources
# The name of your Azure DevOps organization
# Example: If your ADO URL is https://dev.azure.com/contoso, use "contoso"
# GHMIG_SOURCE_ORGANIZATION=your-ado-org

# =============================================================================
# Destination Repository System Configuration
# =============================================================================

# Destination system type
# Supported: "github" (only GitHub is supported as destination)
GHMIG_DESTINATION_TYPE=github

# --- GitHub Destination Configuration ---
# Destination GitHub Personal Access Token (PAT) - REQUIRED
# This token is REQUIRED for all migration operations
# For GitHub.com, GitHub with data residency, GHEC EMU, or GitHub Enterprise Server
# Required permissions:
# - Organization admin access (required)
# - Scopes: repo, admin:org, workflow
# Usage: If GitHub App is configured, PAT is used for migrations only
GHMIG_DESTINATION_TOKEN=ghp_yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy

# Destination GitHub Base URL
# For GitHub.com or GitHub with data residency: https://api.github.com
# For GitHub Enterprise Server: https://github.company.com/api/v3
GHMIG_DESTINATION_BASE_URL=https://api.github.com

# --- GitHub App Destination Authentication (Optional) ---
# GitHub App authentication is OPTIONAL and recommended for large migrations
# When configured, GitHub App tokens are used ONLY for discovery and profiling operations
# The PAT above is still REQUIRED and used for all migration operations
# Benefits: Better rate limits for discovery, separation of concerns, reduced PAT usage
# GHMIG_DESTINATION_APP_ID=123456
# GHMIG_DESTINATION_APP_PRIVATE_KEY=/path/to/private-key.pem
# Or inline PEM:
# GHMIG_DESTINATION_APP_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\nMIIE...\n-----END RSA PRIVATE KEY-----"
# GHMIG_DESTINATION_APP_INSTALLATION_ID=789012

# =============================================================================
# Server Configuration
# =============================================================================

# Server port (default: 8080)
GHMIG_SERVER_PORT=8080

# =============================================================================
# Temporary Directory Configuration (Optional)
# =============================================================================

# Custom temporary directory for binary extraction and repository clones
# Default: Uses system temp directory (os.TempDir())
# Azure App Service: Automatically uses /home/site/tmp (no configuration needed)
# 
# Only set this if you need to override the default temp directory location
# Example use cases:
# - Custom storage with more space
# - Specific security requirements
# - Non-standard container environments
#
# GHMIG_TEMP_DIR=/custom/temp/path

# =============================================================================
# Database Configuration
# =============================================================================

# Database type: "sqlite" or "postgres"
# - sqlite: Recommended for development and small deployments
# - postgres: Recommended for production
GHMIG_DATABASE_TYPE=sqlite

# Database DSN (Data Source Name)
# SQLite example:
GHMIG_DATABASE_DSN=./data/migrator.db

# PostgreSQL example:
# GHMIG_DATABASE_DSN=postgres://user:password@localhost:5432/migrator?sslmode=disable

# Alternative PostgreSQL URL (also supported):
# GHMIG_DATABASE_DSN=postgres://migrator_user:secure_password@localhost:5432/migrator?sslmode=require

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level: debug, info, warn, error
# - debug: Verbose logging (recommended for development)
# - info: Standard logging (recommended for production)
# - warn: Only warnings and errors
# - error: Only errors
GHMIG_LOGGING_LEVEL=info

# Log format: json or text
# - json: Structured JSON logs (recommended for production)
# - text: Human-readable format (good for development)
GHMIG_LOGGING_FORMAT=json

# Log output file path
GHMIG_LOGGING_OUTPUT_FILE=./logs/migrator.log

# Log file maximum size in megabytes before rotation (default: 100)
GHMIG_LOGGING_MAX_SIZE=100

# Maximum number of old log files to retain (default: 3)
GHMIG_LOGGING_MAX_BACKUPS=3

# Maximum number of days to retain old log files (default: 28)
GHMIG_LOGGING_MAX_AGE=28

# =============================================================================
# Migration Configuration
# =============================================================================

# Note: Destination organization is determined per-repository via the API/UI
# By default, repositories migrate to the same organization name as the source
# You can override this per-repository using the destination_full_name field

# Number of parallel migration workers (default: 5)
# Higher values = faster migrations but more API rate limit usage
# Recommended: 5-10 for most deployments
GHMIG_MIGRATION_WORKERS=5

# Polling interval in seconds (default: 30)
# How often workers check for new repositories to migrate
GHMIG_MIGRATION_POLL_INTERVAL_SECONDS=30

# Post-migration validation mode (default: production_only)
# Options: never, production_only, dry_run_only, always
# Recommended: production_only
GHMIG_MIGRATION_POST_MIGRATION_MODE=production_only

# What to do if destination repository exists (default: fail)
# Options: fail (safest), skip, delete (dangerous!)
# Recommended: fail
GHMIG_MIGRATION_DEST_REPO_EXISTS_ACTION=fail

# Visibility transformation rules (default: all repos become private)
# Controls how repository visibility is mapped from source to destination
# IMPORTANT: GitHub visibility controls who can read the repository:
# - public: Anyone with the URL can read/clone
# - internal: Anyone in the Enterprise can read/clone
# - private: Only users with explicit access can read/write
#
# Note: EMU and data residency environments do NOT support public repositories

# How to handle public repositories (default: private)
# Options: public, internal, or private
# - "public": Keep as public (fails in EMU/data residency)
# - "internal": Convert to internal (maintains enterprise-wide read access)
# - "private": Convert to private (most restrictive, safest)
GHMIG_MIGRATION_VISIBILITY_PUBLIC_REPOS=private

# How to handle internal repositories (default: private)
# Options: internal or private
# - "internal": Keep as internal (requires Enterprise Cloud)
# - "private": Convert to private (works everywhere)
GHMIG_MIGRATION_VISIBILITY_INTERNAL_REPOS=private

# Note: Private repositories always migrate as private

# =============================================================================
# Authentication & Authorization Configuration (Optional)
# =============================================================================
# IMPORTANT: Authentication is DISABLED by default for backward compatibility
# Enable for production deployments to control who can access the system
# See OPERATIONS.md for OAuth App setup instructions

# Enable/disable authentication (default: false)
# Set to "true" to require GitHub OAuth authentication
GHMIG_AUTH_ENABLED=false

# GitHub OAuth Application Configuration
# Required when GHMIG_AUTH_ENABLED=true
# Create an OAuth App at:
# - GitHub.com: https://github.com/settings/developers
# - GHES: https://your-ghes/settings/developers
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_ID=Iv1.abcd1234efgh5678
# GHMIG_AUTH_GITHUB_OAUTH_CLIENT_SECRET=your-oauth-client-secret-here

# GitHub OAuth Base URL (optional)
# Defaults intelligently based on source/destination configuration:
# - If source is GitHub: uses source base URL
# - Otherwise: uses destination base URL
# Only override if you need OAuth to authenticate against a different GitHub instance
# GHMIG_AUTH_GITHUB_OAUTH_BASE_URL=https://github.company.com/api/v3

# OAuth callback URL
# Must match the callback URL configured in your OAuth App
# Format: https://your-migrator-domain.com/api/v1/auth/callback
# GHMIG_AUTH_CALLBACK_URL=https://migrator.company.com/api/v1/auth/callback

# Azure DevOps Authentication (Entra ID OAuth)
# Required when GHMIG_SOURCE_TYPE=azuredevops and GHMIG_AUTH_ENABLED=true
# Provides user-level access control for ADO organizations and projects
# The server-level ADO PAT is used for migration execution

# Enable Entra ID OAuth for Azure DevOps (default: false)
# Only used when source type is azuredevops
# GHMIG_AUTH_ENTRAID_ENABLED=false

# Microsoft Entra ID (Azure AD) Tenant ID
# Find in Azure Portal → Azure Active Directory → Overview
# Example: 12345678-1234-1234-1234-123456789012
# GHMIG_AUTH_ENTRAID_TENANT_ID=your-tenant-id

# Entra ID Application (Client) ID
# Create App Registration in Azure Portal → Azure Active Directory → App registrations
# GHMIG_AUTH_ENTRAID_CLIENT_ID=your-client-id

# Entra ID Application Client Secret
# Generate in Azure Portal → App registrations → Your App → Certificates & secrets
# GHMIG_AUTH_ENTRAID_CLIENT_SECRET=your-client-secret

# Entra ID OAuth Callback URL
# Must match redirect URI in Entra ID App Registration
# Format: https://your-migrator-domain.com/api/v1/auth/entraid/callback
# GHMIG_AUTH_ENTRAID_CALLBACK_URL=https://migrator.company.com/api/v1/auth/entraid/callback

# Azure DevOps Organization URL
# Used to validate user access to the ADO organization
# Format: https://dev.azure.com/your-organization
# GHMIG_AUTH_ADO_ORGANIZATION_URL=https://dev.azure.com/your-ado-org

# Frontend URL to redirect to after successful login
# In production with integrated frontend/backend: use "/" (same domain)
# In development with separate ports: use "http://localhost:3000"
# Default: "http://localhost:3000"
# GHMIG_AUTH_FRONTEND_URL=/

# Session secret key for JWT signing
# MUST be a strong random string (32+ characters)
# Generate with: openssl rand -base64 32
# IMPORTANT: Keep this secret and don't commit to version control!
# GHMIG_AUTH_SESSION_SECRET=your-random-secret-key-at-least-32-characters-long

# Session duration in hours (default: 24)
# How long users stay logged in before re-authentication required
# GHMIG_AUTH_SESSION_DURATION_HOURS=24

# Authorization Rules (Optional)
# Control WHO can access the system after authentication
# If not specified, any authenticated GitHub user can access

# Require org membership (comma-separated list)
# User must be member of AT LEAST ONE of these organizations
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ORG_MEMBERSHIP=my-company-org,migration-team-org

# Require team membership (comma-separated list, format: org/team-slug)
# User must be member of AT LEAST ONE of these teams
# Team slugs are lowercase with hyphens (e.g., "platform-team")
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_TEAM_MEMBERSHIP=my-company-org/migration-admins,my-company-org/platform-team

# Require enterprise admin (default: false)
# If true, only GitHub Enterprise admins can access the system
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_ADMIN=false

# Require enterprise membership (default: false)
# If true, any member of the enterprise can access the system (admins or members)
# More permissive than require_enterprise_admin - allows all enterprise members
# Repository-level permissions still apply to limit what they can migrate
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_MEMBERSHIP=false

# Enterprise slug for admin/membership verification
# Required if GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_ADMIN or
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_MEMBERSHIP is true
# NOTE: If configured, enterprise admins automatically get FULL MIGRATION ACCESS
#       (can migrate any repository), regardless of require_enterprise_admin setting
# GHMIG_AUTH_AUTHORIZATION_RULES_REQUIRE_ENTERPRISE_SLUG=my-enterprise

# Privileged teams (comma-separated list, format: org/team-slug)
# Members of these teams have FULL ACCESS to migrate any repository
# This bypasses per-repository permission checks
# Use for migration admin teams that should have unrestricted access
# GHMIG_AUTH_AUTHORIZATION_RULES_PRIVILEGED_TEAMS=my-company-org/migration-admins,my-company-org/platform-team

# Repository-Level Permissions (Default Behavior):
# Once a user passes application-level authorization checks above, their repository
# access is determined by GitHub permissions on the source instance:
# - Enterprise admins: Can migrate all repositories (when enterprise slug is configured)
# - Privileged team members: Can migrate all repositories (bypass permission checks)
# - Org admins: Can migrate all repositories in their organizations
# - Repository admins: Can ONLY migrate repositories they have admin access to
# This ensures developers can self-service migrate their own repos while maintaining security.

# =============================================================================
# Important Notes
# =============================================================================

# 1. SUPPORTED MIGRATIONS
#    Currently only GitHub-to-GitHub migrations are fully supported.
#    Source: GitHub.com or GitHub Enterprise Server
#    Destination: GitHub.com, GitHub with data residency, or GitHub Enterprise Server
#    Note: GitLab and Azure DevOps support is in development but not yet ready
#
# 2. TOKENS MUST HAVE ORGANIZATION ADMIN ACCESS
#    Both source and destination tokens require organization admin permissions
#    for migrations to work properly.
#
# 3. AUTHENTICATION REQUIREMENTS
#    - PAT (Personal Access Token) is REQUIRED for all migrations
#    - GitHub App authentication is OPTIONAL for discovery and profiling operations
#    - When both are configured: GitHub App used for discovery, PAT used for migrations
#    - Benefit of GitHub App: Better rate limits for discovery operations
#
# 4. DESTINATION ORGANIZATION MAPPING
#    The destination organization for each repository can be customized
#    per-repository via the API or web interface. By default, it uses
#    the same organization name as the source.
#
# 5. AUTHENTICATION (OPTIONAL)
#    Authentication is DISABLED by default for backward compatibility.
#    Enable for production to control access via GitHub OAuth.
#    Supports org membership, team membership, or enterprise admin requirements.
#    See OPERATIONS.md for setup instructions.
#
# 6. SENSITIVE VALUES
#    Never commit this file with real tokens, secrets, or keys to version control.
#    Use environment variables or a secrets management system in production.
#    This includes: PAT tokens, OAuth secrets, session secrets, and private keys.
#
# 7. PRODUCTION DEPLOYMENTS
#    For production, use PostgreSQL instead of SQLite, enable authentication,
#    and configure proper log rotation and monitoring.
#
# 8. RATE LIMITS
#    GitHub API rate limits apply. Adjust GHMIG_MIGRATION_WORKERS based on
#    your available rate limit quota. GitHub App authentication provides
#    higher rate limits than PAT-only authentication.
